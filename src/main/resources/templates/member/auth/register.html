<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <meta charset="UTF-8">
    <script src="/static/js/jquery/jquery-3.5.1.js"></script>
    <style>
        .register {
            background-color: white;
            padding: 20px;
            border: 1px solid slategray;
            border-radius: 10px;
        }
    </style>
    <title>천둥장터</title>
</head>
<body>
<body class="bg-light text-center">
<h2><b>회원가입</b></h2>
<form class="register" th:action="@{/member/auth/register}" method="post" style="max-width: 500px;margin: auto">
    <div class="mb-3">
        <label for="exampleInputMemberId" class="form-label">아이디</label>
        <input type="text" class="form-control" name="memberId" id="exampleInputMemberId" aria-describedby="member" maxlength="20">
        <div id="valid-Id"></div>
    </div>
    <div class="mb-3">
        <label for="exampleInputPassword" class="form-label">비밀번호</label>
        <input type="password" class="form-control" name="password" id="exampleInputPassword" maxlength="20">
        <div class="invalid-feedback" id="empty-password">
            비밀번호를 입력해주세요.
        </div>
    </div>
    <div class="mb-3">
        <label for="exampleInputName" class="form-label">이름</label>
        <input type="text" class="form-control" name="name" id="exampleInputName" maxlength="40">
        <div id="valid-name"></div>
    </div>
    <div class="mb-3">
        <label for="exampleSelectGender" class="form-label">성별</label>
        <select class="form-select" aria-label="성별" name="gender" id="exampleSelectGender">
            <option selected>성별</option>
            <option value="남자">남자</option>
            <option value="여자">여자</option>
            <option value="선택안함">선택안함</option>
        </select>
        <div id="valid-gender"></div>
    </div>
    <div class="mb-3">
        <div class="row bir_wrap" style="max-width: 100px">
            <div class="col bir_yy">
                <input type="text" id="yy" placeholder="년(4자)" aria-label="년(4자)" class="int" maxlength="4">
            </div>
            <div class="col bir_mm" style="max-width: 100px">
                    <span class="ps_box">
                        <select id="mm" class="form-select" aria-label="월">
                            <option value="">월</option>
                            <option value="01">
                                1
                            </option>
                            <option value="02">
                                2
                            </option>
                            <option value="03">
                                3
                            </option>
                            <option value="04">
                                4
                            </option>
                            <option value="05">
                                5
                            </option>
                            <option value="06">
                                6
                            </option>
                            <option value="07">
                                7
                            </option>
                            <option value="08">
                                8
                            </option>
                            <option value="09">
                                9
                            </option>
                            <option value="10">
                                10
                            </option>
                            <option value="11">
                                11
                            </option>
                            <option value="12">
                                12
                            </option>
                        </select>
                    </span>
            </div>
            <div class="=col bir_dd" style="max-width: 100px">
                <input type="text" id="dd" placeholder="일" aria-label="일" class="int" maxlength="2"">
            </div>
        </div>
        <div id="valid-birth"></div>
    </div>
    <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">이메일 (선택)</label>
        <input type="email" class="form-control" name="email" id="exampleInputEmail1" aria-describedby="emailHelp" maxlength="100" placeholder="선택입력">
        <div id="emailHelp" class="form-text">절대 남과 공유금지</div>
    </div>
    <div class="mb-3">
        <label for="exampleInputPhoneNumber" class="form-label">전화번호 (필수)</label>
        <input type="tel" class="form-control" name="phoneNumber" id="exampleInputPhoneNumber" aria-describedby="phoneNumberHelp" placeholder="010-0000-0000" maxlength="16">
        <div class="invalid-feedback" id="empty-phoneNumber">
            전화번호를 입력해주세요.
        </div>
        <div id="phoneNumberHelp" class="form-text">절대 남과 공유금지</div>
    </div>
    <input class="btn btn-primary" type="submit" value="가입하기">
</form>
<script>
    $("#exampleInputMemberId").blur(function () {
        checkId($("#exampleInputMemberId").val());
    });

    $("#exampleInputPassword").blur(function () {

        const id = $("#exampleInputPassword").val();

        if (id === "") {
            $("#empty-password").show();
        }
    });

    $("#exampleInputName").blur(function () {

        checkName($("#exampleInputName").val());
    });

    $("#exampleSelectGender").blur(function () {
        checkGender($("#exampleSelectGender").val());
    });

    $("#exampleInputPhoneNumber").blur(function () {

        const id = $("#exampleInputPhoneNumber").val();

        if (id === "") {
            $("#empty-phoneNumber").show();
        }
    });

    function checkId(id) {

        const IdRegx = RegExp(/^[a-z0-9][a-z0-9_\-]{4,19}$/);

        if (id === "") {
            $("#valid-Id")
                .html('아이디를 입력해주세요.')
                .css({'color':"#dc3545", 'font-size':".875em"});
            return false;
        }

        if (!IdRegx.test(id)) {
            $("#valid-Id")
                .html('5~20자의 영문 소문자, 숫자와 특수기호(_),(-)만 사용 가능합니다.')
                .css({'color':"#dc3545", 'font-size':".875em"});
            return false;
        }

        $.ajax({
            type:"GET",
            url:"/member/auth/memberIdValidation?memberId=" + id,
            success: function (data) {
                if (data === 0) {
                    $("#valid-Id")
                        .html('멋진 아이디입니다!')
                        .css({'color':"#198754", 'font-size':".875em"});
                } else {
                    $("#valid-Id")
                        .html('이미 사용중이거나 탈퇴한 아이디입니다.')
                        .css({'color':"#dc3545", 'font-size':".875em"});
                    return false;
                }
            }
        });

        return true;
    }

    function checkName(name) {

        const nameRegx = RegExp(/^[ㄱ-ㅎ가-힣a-zA-Z]+$/);

        if (name === "") {
            $("#valid-name")
                .html("이름을 입력해주세요.")
                .css({'color':"#dc3545", 'font-size':".875em"});
            return false;
        }

        if (!nameRegx.test(name)) {
            $("#valid-name")
                .html("한글과 영문 대 소문자를 사용하세요. (특수기호, 공백 사용 불가)")
                .css({'color':"#dc3545", 'font-size':".875em"});
            return false;
        } else {
            $("#valid-name")
                .html("")
        }

        return true;
    }


    function checkGender(gender) {
        if(gender === "성별") {
            $("#valid-gender")
                .html("성별을 선택해주세요.")
                .css({'color':"#dc3545", 'font-size':".875em"});
            return false;
        } else {
            $("#valid-gender").html("");
        }

        return true;
    }


</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>
</html>